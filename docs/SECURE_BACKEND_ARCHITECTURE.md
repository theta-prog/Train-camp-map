# ğŸ”’ å®Œå…¨åˆ†é›¢å‹ã‚»ã‚­ãƒ¥ã‚¢ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹æˆ

## ğŸ—ï¸ **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚â”€â”€â”€â”€â”‚   API Routes     â”‚â”€â”€â”€â”€â”‚   Database      â”‚
â”‚   (Next.js)     â”‚    â”‚   (Server-side)  â”‚    â”‚   (PostgreSQL)  â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ - UI Components â”‚    â”‚ - Authentication â”‚    â”‚ - User Table    â”‚
â”‚ - Client State  â”‚    â”‚ - Authorization  â”‚    â”‚ - Campsite      â”‚
â”‚ - API Requests  â”‚    â”‚ - Business Logic â”‚    â”‚ - Relations     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                        â†‘                        â†‘
       â”‚                        â”‚                        â”‚
   HTTP/HTTPS              JWT + Cookies            Connection Pool
```

## ğŸ” **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç‰¹å¾´**

### âœ… **å®Œå…¨åˆ†é›¢**
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰DBã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ **å®Œå…¨é®æ–­**
- ã™ã¹ã¦ã®DBæ“ä½œã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰APIçµŒç”±
- Prisma Clientã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ã¿åˆ©ç”¨å¯èƒ½

### âœ… **èªè¨¼ãƒ»èªå¯**
- JWT + HttpOnly Cookies
- ç®¡ç†è€…æ¨©é™ã®å³æ ¼ãªãƒã‚§ãƒƒã‚¯
- è¨±å¯ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã®ã¿ç™»éŒ²å¯èƒ½

### âœ… **ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®å®Œå…¨ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã‚’é˜²æ­¢
- XSSæ”»æ’ƒå¯¾ç­–

## ğŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ prisma.ts          # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ï¼‰
â”‚   â””â”€â”€ auth.ts            # èªè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ï¼‰
â”œâ”€â”€ app/api/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login/route.ts     # ãƒ­ã‚°ã‚¤ãƒ³API
â”‚   â”‚   â””â”€â”€ register/route.ts  # ç™»éŒ²API
â”‚   â””â”€â”€ secure/
â”‚       â””â”€â”€ campsites/route.ts # ã‚»ã‚­ãƒ¥ã‚¢ãªã‚­ãƒ£ãƒ³ãƒ—ã‚µã‚¤ãƒˆAPI
â”œâ”€â”€ middleware.ts          # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â””â”€â”€ prisma/
    â””â”€â”€ schema.prisma      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
```

## ğŸ”§ **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †**

### 1. **ç’°å¢ƒå¤‰æ•°è¨­å®š**
```bash
# .env.local ã‚’ä½œæˆ
DATABASE_URL=postgresql://username:password@localhost:5432/campsite_db
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
ADMIN_ALLOWED_EMAILS=admin@example.com
```

### 2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–**
```bash
# Prisma migration
npx prisma migrate dev --name init

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç”Ÿæˆ
npx prisma generate

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
npx prisma studio
```

### 3. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
```bash
npm run dev
```

## ğŸ›¡ï¸ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–**

### 1. **èªè¨¼ãƒ•ãƒ­ãƒ¼**
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’é€ä¿¡
2. ã‚µãƒ¼ãƒãƒ¼ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚’æ¤œè¨¼
3. JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦HttpOnly Cookieã«ä¿å­˜
4. ä»¥é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼

### 2. **èªå¯åˆ¶å¾¡**
- ç®¡ç†è€…ã‚¨ãƒªã‚¢: ç®¡ç†è€…æ¨©é™å¿…é ˆ
- ã‚»ã‚­ãƒ¥ã‚¢API: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã”ã¨ã«æ¨©é™ãƒã‚§ãƒƒã‚¯
- ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ã®ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ä¿è­·

### 3. **ãƒ‡ãƒ¼ã‚¿ä¿è­·**
- ã™ã¹ã¦ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–
- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆPrisma ORMï¼‰
- XSSå¯¾ç­–ï¼ˆHttpOnly Cookies + CSPï¼‰

## ğŸ“Š **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**

### èªè¨¼API
- `POST /api/auth/login` - ãƒ­ã‚°ã‚¤ãƒ³
- `POST /api/auth/register` - ç®¡ç†è€…ç™»éŒ²

### ã‚»ã‚­ãƒ¥ã‚¢API
- `GET /api/campsites` - ã‚­ãƒ£ãƒ³ãƒ—ã‚µã‚¤ãƒˆä¸€è¦§ï¼ˆèªè¨¼ä¸è¦ï¼‰
- `POST /api/campsites` - ã‚­ãƒ£ãƒ³ãƒ—ã‚µã‚¤ãƒˆä½œæˆï¼ˆç®¡ç†è€…æ¨©é™å¿…è¦ï¼‰
- `PUT /api/campsites/[id]` - ã‚­ãƒ£ãƒ³ãƒ—ã‚µã‚¤ãƒˆæ›´æ–°ï¼ˆç®¡ç†è€…æ¨©é™å¿…è¦ï¼‰
- `DELETE /api/campsites/[id]` - ã‚­ãƒ£ãƒ³ãƒ—ã‚µã‚¤ãƒˆå‰Šé™¤ï¼ˆç®¡ç†è€…æ¨©é™å¿…è¦ï¼‰

## ğŸ”„ **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †**

### Supabaseã‹ã‚‰ã®ç§»è¡Œ
1. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
2. PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™
3. ç’°å¢ƒå¤‰æ•°ã®æ›´æ–°
4. Prismaãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ
5. ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆä¾‹ï¼‰
```bash
# Supabaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
pg_dump -h your-supabase-host -U postgres -d postgres > backup.sql

# æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
psql -h localhost -U username -d campsite_db < backup.sql
```

## ğŸš€ **æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤**

### ç’°å¢ƒå¤‰æ•°
```bash
DATABASE_URL=postgresql://prod-user:prod-pass@prod-host:5432/prod-db
JWT_SECRET=extremely-long-and-random-production-secret
NEXTAUTH_URL=https://your-domain.com
NODE_ENV=production
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] JWT_SECRET ãŒååˆ†ã«é•·ããƒ©ãƒ³ãƒ€ãƒ 
- [ ] DATABASE_URL ãŒæœ¬ç•ªç”¨
- [ ] HTTPS ãŒæœ‰åŠ¹
- [ ] ADMIN_ALLOWED_EMAILS ãŒé©åˆ‡ã«è¨­å®š
- [ ] Rate limiting ã®å®Ÿè£…ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

ã“ã®æ§‹æˆã«ã‚ˆã‚Šã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå®Œå…¨ã«åˆ†é›¢ã•ã‚Œã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã—ãŸã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰DBã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã¯å®Œå…¨ã«ä¸å¯èƒ½ã«ãªã‚Šã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿æ“ä½œã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§åˆ¶å¾¡ã•ã‚Œã¾ã™ã€‚
